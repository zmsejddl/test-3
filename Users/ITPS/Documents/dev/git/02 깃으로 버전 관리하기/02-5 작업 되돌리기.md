# 02-5 작업 되돌리기
- 스테이지에 올렸던 파일을 내리거나 커밋을 취소하는 등 각 단계로 돌아가는 방법을 알아보겠다

**작업 트리에서 수정한 파일 되돌리기 - git restore**
- 소스를 수정했다고 가정해 보겠다. 파일을 수정한 후 소스가 정상으로 동작하지 않거나 다른 이유로 수정한 것을 취소하고 가장 최신 버전 상태로 되돌려야 할 때가 있다. 그런데 일일이 소스를 뒤지면서 수정했던 것을 다시 되돌려야 했다. 깃으로는 작업 디렉터리에서 수정한 내용을 되돌리려면 restore 명령을 사용하면 된다

1. 먼저 빔 편집기에서 hello.txt 파일을 연다. 그리고 숫자 '3'을 'three'로 수정한 후 저장하고 편집기를 종료한다
2. git status 명령으로 상태를 확인한다. hello.txt가 수정되었지만 아직 스테이지에 올라가 있지 않다. 그리고 두 번째 괄호 안의 메시지를 보면, 작업 디렉터리의 변경 사항을 취소하려면 restore 명령을 사용하라고 되어 있다.
3. 조금 전에 수정했던 hello.txt의 수정 사항을 취소해 보겠다
```bash
$ git restore hello.txt
```
4. 취소가 잘 되었는지 cat 명령으로 확인해 보겠다. 수정했던 것이 제대로 취소된 것을 확인할 수 있다
```bash
$ cat hello.txt
```

**스테이징 되돌리기 - git restore --staged**
- 이번에는 수정된 파일을 스테이징까지 했을 때 스테이징을 취소하는 방법을 살펴보겠다
1. 빔을 사용해서 hello2.txt를 수정해보겠다. 기존 내용을 삭제하고 대문자 A, B, C, D를 입력한 후 저장하고 편집기를 종료한다
2. git add 명령으로 hello2.txt 파일을 스테이지에 올린 후 git status 명령으로 파일 상태를 살펴본다
3. git restore --staged : 스테이지에 있는 모든 파일을 한꺼번에 되돌릴 수 있다
4. --staged 옵션 뒤에 파일 이름을 넣으면 해당 파일만 골라서 되돌릴 수 있다
```bash
$ git restore --staged hello2.txt
```

**최신 커밋 되돌리기 - git reset HEAD^**
- 수정된 파일을 스테이징하고 커밋까지 했을 때 가장 마지막에 한 커밋을 취소하는 방법을 알아보겠다. 커밋을 취소하면 스테이징이 함께 취소된다
1. hello2.txt 문서를 수정한다. 대문자 E를 끝에 추가한 후 저장한다
2. 스테이징과 커밋을 함께 실행한다. 메시지는 message4로 하겠다
```bash
$ git commit -am "message4" 
```
3. git log로 확인한다
4. 최신 커밋을 되돌린다. 이렇게 되돌리면 main의 최신 커밋도 취소되고 스테이지에서도 내려진다
```bash
$ git reset HEAD^
```
5. git log 명령으로 커밋이 사라진 것을 볼 수 있다

**git reset 명령의 옵션**
명령|설명
---|---
$ git reset --soft HEAD^ | 커밋을 취소하고 파일을 staged 상태로 작업 디렉터리에 보관한다
$ git reset --mixed HEAD^ | 커밋을 취소하고 파일을 unstaged 상태로 작업 디렉터리에 보관한다
$ git reset HEAD^ | -- --mixed 옵션을 사용할 때와 같이, 커밋을 취소하고 unstaged 상태로 작업 디렉터리에 보관한다

**특정 커밋으로 되돌리기 - git reset 해시**
-  특정 버전으로 되돌려 놓고 그 이후 버전을 삭제할 수도 있다
1. rev.txt 만들고 영문자 'a'를 입력한 후 저장
2. 커밋한다
```bash
$ git add rev.txt
$ git commit -m "R1"
```
3. rev.txt에 영문자 'b'를 추가하고, R2 메세지와 함께 커밋
4. rev.txt에 영문자 'c'를 추가한 후 R3 메세지와 함께 커밋하고, rev.txt에 영문자 'd'를 추가한 후 R4 메시지와 함께 커밋한다
5. git log로 확인한다
6. 커밋 4개 가운데 R2라는 메시지가 붙은 R2 커밋으로 되돌려 보겠다. R3 커밋과 R4 커밋은 삭제되고 R2 커밋이 최신 커밋이 된다
7. 커밋 되돌리기
```bash
$ git reset --hard 해당 커밋의 해시
```
8. 되돌린 커밋이 최신 커밋이 되었다
9. rev.txt 파일의 내용을 확인한다

**커밋 변경 이력 취소하기 - git revert**
- 커밋했던 기록은 남겨 두고 변경 사항만 취소한다
1. rev.txt 파일을 한 번 더 수정해서 영문자 'e'를 추가한다. R5 라는 메시지와 함께 커밋한다
2. R5 커밋을 삭제하지 않고 R2로 되돌리려면 revert 명령을 사용한다. R5의 커밋 해시를 지정한다
3. revert 명령을 사용해서 R5 커밋을 취소한다
```bash
$ git revert 복사한 커밋 해시
```
4. 커밋을 취소하면서 남겨 둘 내용이 있다면 문서에 입력하고 저장한다
5. 로그에 R5를 revert한 새로운 커밋이 생긴다. 그리고 기존의 R5 역시 사라지지 않는다. R5 버전을 지우는 대신 R5에서 변경했던 내용만 취소하고, R5를 취소했다는 커밋을 해로 만든 것이다
6. rev.txt가 R5 커밋을 취소한 것이 문서에도 반영되었는지 확인해 보자